{% comment %}
  Virtual Try-On Widget - Snippet for Manual Integration
  Usage: {% render 'vton-widget' %}
  
  This snippet can be manually added to your theme's product template.
  Add it in your product.liquid or product-form.liquid file, typically
  after the "Add to Cart" button section.
{% endcomment %}

{% if template.name == 'product' %}
  <div 
    id="vton-widget-container" 
    data-vton-widget="true"
    data-vton-container="true"
    style="margin: 16px 0; width: 100%;"
  >
    {% comment %} Widget will be injected here automatically {% endcomment %}
  </div>

  <script>
    (function() {
      'use strict';
      
      // Only load widget script if not already loaded
      if (window.VTONWidgetLoaded) {
        console.log('[VTON] Widget already loaded, skipping');
        return;
      }
      
      window.VTONWidgetLoaded = true;
      
      // Get app URL - use shop URL with app proxy path
      // The app proxy is configured to route /apps/tryon/* to the app
      const shopUrl = '{{ shop.url }}';
      const appUrl = shopUrl; // Use shop URL, app proxy will route to the app
      
      // Use timestamp for cache busting
      const cacheBuster = Date.now();
      const widgetUrl = `${appUrl}/apps/tryon/widget-v2.js?v=${cacheBuster}`;
      
      console.log('[VTON] Loading widget from:', widgetUrl);
      
      // Load widget script
      const script = document.createElement('script');
      script.src = widgetUrl;
      script.defer = true;
      script.async = true;
      script.crossOrigin = 'anonymous';
      
      script.onload = function() {
        console.log('[VTON] Widget script loaded successfully');
      };
      
      script.onerror = function() {
        console.error('[VTON] Failed to load widget script from:', widgetUrl);
      };
      
      document.head.appendChild(script);
    })();
  </script>
{% endif %}

