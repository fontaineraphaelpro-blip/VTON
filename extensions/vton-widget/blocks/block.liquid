{% comment %}
  Virtual Try-On Widget - Theme App Extension Block
  This block loads the VTON widget script on product pages
  The widget is automatically injected via Script Tags, but this block provides
  a way for merchants to manually add it to their theme if needed.
{% endcomment %}

{% if template.name == 'product' %}
  <div 
    id="vton-widget-container" 
    data-vton-widget="true"
    style="margin: 16px 0;"
  >
    {% comment %} Widget will be injected here automatically {% endcomment %}
  </div>

<script>
    (function() {
      'use strict';
      
      // Only load widget script if not already loaded
      if (window.VTONWidgetLoaded) {
            return;
          }
          
      window.VTONWidgetLoaded = true;
      
      // Get app URL from shop settings or use default
      const appUrl = '{{ shop.metafields.vton.app_url }}' || '{{ shop.url }}';
      const widgetUrl = `${appUrl}/apps/tryon/widget-v2.js?v=${Date.now()}`;
      
      // Load widget script
      const script = document.createElement('script');
      script.src = widgetUrl;
      script.defer = true;
      script.async = true;
      script.onerror = function() {
        console.error('[VTON] Failed to load widget script from:', widgetUrl);
      };
      
      document.head.appendChild(script);
    })();
  </script>
{% endif %}

{% schema %}
{
  "name": "Virtual Try-On Widget",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Virtual Try-On Configuration"
    },
    {
      "type": "paragraph",
      "content": "This block automatically loads the Virtual Try-On widget on product pages. The widget will appear next to the 'Add to Cart' button."
    },
    {
      "type": "paragraph",
      "content": "Note: The widget is also automatically installed via Script Tags. This block is optional and can be used for manual integration."
    }
  ]
}
{% endschema %}
